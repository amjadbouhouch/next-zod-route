"use strict";var y=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var C=(a,e)=>{for(var t in e)y(a,t,{get:e[t],enumerable:!0})},R=(a,e,t,d)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of g(e))!M.call(a,s)&&s!==t&&y(a,s,{get:()=>e[s],enumerable:!(d=p(e,s))||d.enumerable});return a};var z=a=>R(y({},"__esModule",{value:!0}),a);var E={};C(E,{createZodRoute:()=>S});module.exports=z(E);var i=class extends Error{constructor(e){super(e),this.name="InternalRouteHandlerError"}},h=class a{config;middlewares;handleServerError;metadataValue;contextType;constructor({config:e={paramsSchema:void 0,querySchema:void 0,bodySchema:void 0,metadataSchema:void 0},middlewares:t=[],handleServerError:d,contextType:s,metadataValue:m}){this.config=e,this.middlewares=t,this.handleServerError=d,this.contextType=s,this.metadataValue=m}params(e){return new a({...this,config:{...this.config,paramsSchema:e}})}query(e){return new a({...this,config:{...this.config,querySchema:e}})}body(e){return new a({...this,config:{...this.config,bodySchema:e}})}defineMetadata(e){return new a({...this,config:{...this.config,metadataSchema:e}})}metadata(e){return new a({...this,metadataValue:e})}use(e){return new a({...this,middlewares:[...this.middlewares,e],contextType:{}})}handler(e){return async(t,d)=>{try{let s=new URL(t.url),m=d?.params?await d.params:{},l=Object.fromEntries([...s.searchParams.keys()].map(r=>{let o=s.searchParams.getAll(r);return o.length===1?[r,o[0]]:[r,o]})),u=this.metadataValue,T={};if(t.method!=="GET"&&t.method!=="DELETE")try{let r=t.headers.get("content-type")||"";if(r.includes("multipart/form-data")||r.includes("application/x-www-form-urlencoded")){let o=await t.formData();T=Object.fromEntries(o.entries())}else T=await t.json()}catch(r){if(this.config.bodySchema)throw new i(JSON.stringify({message:"Invalid body",errors:r}))}if(this.config.paramsSchema){let r=this.config.paramsSchema.safeParse(m);if(!r.success)throw new i(JSON.stringify({message:"Invalid params",errors:r.error.issues}));m=r.data}if(this.config.querySchema){let r=this.config.querySchema.safeParse(l);if(!r.success)throw new i(JSON.stringify({message:"Invalid query",errors:r.error.issues}));l=r.data}if(this.config.bodySchema){let r=this.config.bodySchema.safeParse(T);if(!r.success)throw new i(JSON.stringify({message:"Invalid body",errors:r.error.issues}));T=r.data}if(this.config.metadataSchema&&u!==void 0){let r=this.config.metadataSchema.safeParse(u);if(!r.success)throw new i(JSON.stringify({message:"Invalid metadata",errors:r.error.issues}));u=r.data}let c={},f=async r=>{if(r>=this.middlewares.length)try{let n=await e(t,{params:m,query:l,body:T,ctx:c,metadata:u});return n instanceof Response?n:new Response(JSON.stringify(n),{status:200,headers:{"Content-Type":"application/json"}})}catch(n){return w(n,this.handleServerError)}let o=this.middlewares[r];if(!o)return f(r+1);let x=async(n={})=>(n.ctx&&(c={...c,...n.ctx}),await f(r+1));try{let n=await o({request:t,ctx:c,metadata:u,next:x});return n instanceof Response||(c={...c}),n}catch(n){return w(n,this.handleServerError)}};return f(0)}catch(s){return w(s,this.handleServerError)}}}},w=(a,e)=>a instanceof i?new Response(a.message,{status:400}):e?e(a):new Response(JSON.stringify({message:"Internal server error"}),{status:500});function S(a){return new h({handleServerError:a?.handleServerError,contextType:{}})}0&&(module.exports={createZodRoute});
//# sourceMappingURL=index.js.map